/**
 ******************************************************************************
 * @file           : main.c
 * @author         : Auto-generated by STM32CubeIDE
 * @brief          : Main program body
 ******************************************************************************
 * @attention
 *
 * Copyright (c) 2024 STMicroelectronics.
 * All rights reserved.
 *
 * This software is licensed under terms that can be found in the LICENSE file
 * in the root directory of this software component.
 * If no LICENSE file comes with this software, it is provided AS-IS.
 *
 ******************************************************************************
 */
/**
 * PD12: Led
 *
 * PA5->LED
 * PC13 -> Boton de usuario
 */
/*Includes -------------------------------------------------------------------*/
#include "stm32f4xx.h"
#include "hvac_ll_driver.h"
#include "delay.h"
#include "button.h"
/*Defines --------------------------------------------------------------------*/


/*Typedefs -------------------------------------------------------------------*/

/*Global variables -----------------------------------------------------------*/
Button_t sw1;
Button_t sw2;
/*Function prototype ---------------------------------------------------------*/
/**
 * 1: cuando el boton este presionado
 */
uint8_t readButton(uint8_t pin);


int main(void)
{
	/*Local variables --------------------------------------------------------*/

	/*
	 * base tiempo
	 * ticks = Fsysclk/freq
	 * ticks = 16E+6/1000
	 * ticks = 16000
	 */
	SystemCoreClockUpdate();
	SysTick_Config(SystemCoreClock / 1000);
	/**
	 * hardware init
	 */
	hvac_io_init();
	/**
	 * button
	 */
	button_init(&sw1, readButton, getTicks(), 20);
	/* Loop forever */
	for(;;){
		GPIOX_TOGGLE(STATUS);
		delay_ms(100);
	}
}

/*Function definition --------------------------------------------------------*/
uint8_t readButton(uint8_t pin){
	uint8_t state = 0;
	switch(pin){
	case 0:
		state = GPIOX_IDR(SW1);				//pull down
		break;
	case 1:
		state = GPIOX_IDR(SW2) == 0 ? 1 : 0;//pulsador en pull up
		break;
	}
	return state;
}
